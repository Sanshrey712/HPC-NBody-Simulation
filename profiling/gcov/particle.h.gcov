        -:    0:Source:/home/sunny/Desktop/HPC_Project/src/common/particle.h
        -:    0:Graph:./CMakeFiles/nbody_gcov.dir/src/openmp/direct_omp.cpp.gcno
        -:    0:Data:./CMakeFiles/nbody_gcov.dir/src/openmp/direct_omp.cpp.gcda
        -:    0:Runs:4
        -:    1:#ifndef PARTICLE_H
        -:    2:#define PARTICLE_H
        -:    3:
        -:    4:#include "vector3d.h"
        -:    5:
        -:    6:#ifdef __CUDACC__
        -:    7:#define CUDA_HOSTDEV __host__ __device__
        -:    8:#else
        -:    9:#define CUDA_HOSTDEV
        -:   10:#endif
        -:   11:
        -:   12:// AOS (Array of Structures) - traditional layout
        -:   13:struct Particle {
        -:   14:  Vector3D position;
        -:   15:  Vector3D velocity;
        -:   16:  Vector3D acceleration;
        -:   17:  double mass;
        -:   18:  int id;
        -:   19:
        -:   20:  CUDA_HOSTDEV Particle()
        -:   21:      : position(), velocity(), acceleration(), mass(1.0), id(0) {}
        -:   22:
        -:   23:  CUDA_HOSTDEV Particle(const Vector3D &pos, const Vector3D &vel, double m,
        -:   24:                        int pid = 0)
        -:   25:      : position(pos), velocity(vel), acceleration(), mass(m), id(pid) {}
        -:   26:
        -:   27:  // Reset acceleration for new timestep
    #####:   28:  CUDA_HOSTDEV void reset_acceleration() { acceleration = Vector3D(); }
        -:   29:
        -:   30:  // Compute kinetic energy
    #####:   31:  CUDA_HOSTDEV double kinetic_energy() const {
    #####:   32:    return 0.5 * mass * velocity.magnitude_sq();
        -:   33:  }
        -:   34:};
        -:   35:
        -:   36:// SOA (Structure of Arrays) - GPU-optimized layout
        -:   37:struct ParticleSOA {
        -:   38:  double *pos_x;
        -:   39:  double *pos_y;
        -:   40:  double *pos_z;
        -:   41:  double *vel_x;
        -:   42:  double *vel_y;
        -:   43:  double *vel_z;
        -:   44:  double *acc_x;
        -:   45:  double *acc_y;
        -:   46:  double *acc_z;
        -:   47:  double *mass;
        -:   48:  int *id;
        -:   49:  int count;
        -:   50:
        -:   51:  ParticleSOA()
        -:   52:      : pos_x(nullptr), pos_y(nullptr), pos_z(nullptr), vel_x(nullptr),
        -:   53:        vel_y(nullptr), vel_z(nullptr), acc_x(nullptr), acc_y(nullptr),
        -:   54:        acc_z(nullptr), mass(nullptr), id(nullptr), count(0) {}
        -:   55:
        -:   56:  // Allocate memory for n particles
        -:   57:  void allocate(int n);
        -:   58:
        -:   59:  // Free memory
        -:   60:  void deallocate();
        -:   61:
        -:   62:  // Convert from AOS to SOA
        -:   63:  void from_aos(const Particle *particles, int n);
        -:   64:
        -:   65:  // Convert from SOA to AOS
        -:   66:  void to_aos(Particle *particles) const;
        -:   67:};
        -:   68:
        -:   69:#endif // PARTICLE_H
